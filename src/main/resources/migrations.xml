<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd">

    <changeSet id="1" author="dw.quickstarts">
        <!-- Users -->
        <createTable tableName="users">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="username" type="varchar(50)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="firstname" type="varchar(50)">
                <constraints nullable="false" unique="false"/>
            </column>
            <column name="lastname" type="varchar(50)">
                <constraints nullable="false" unique="false"/>
            </column>
            <column name="address" type="varchar(50)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="title" type="varchar(50)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="summary" type="varchar(1000)">
                <constraints nullable="true" unique="false"/>
            </column>
            <column name="salt" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
            <column name="password" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
            <column name="admin" type="boolean">
                <constraints nullable="false"/>
            </column>
            <column name="disabled" type="boolean">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <!-- Skills -->
        <createTable tableName="skills">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="userid" type="bigint">
                <constraints nullable="false" unique="false"/>
            </column>
            <column name="skill" type="varchar(100)">
                <constraints nullable="false" unique="false"/>
            </column>
            <column name="level" type="bigint">
                <constraints nullable="false" unique="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseTableName="skills" baseColumnNames="userid"
                                 constraintName="fk_skill"
                                 onDelete="CASCADE"
                                 onUpdate="NO ACTION"
                                 referencedTableName="users"
                                 referencedColumnNames="id"/>

        <!-- Qualifications -->
        <createTable tableName="qualifications">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="userid" type="bigint">
                <constraints nullable="false" unique="false"/>
            </column>
            <column name="qualification" type="varchar(100)">
                <constraints nullable="false" unique="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseTableName="qualifications" baseColumnNames="userid"
                                 constraintName="fk_qualification"
                                 onDelete="CASCADE"
                                 onUpdate="NO ACTION"
                                 referencedTableName="users"
                                 referencedColumnNames="id"/>

        <!-- Projects -->
        <createTable tableName="projects">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="userid" type="bigint">
                <constraints nullable="false" unique="false"/>
            </column>
            <column name="employer" type="varchar(50)">
                <constraints nullable="false" unique="false"/>
            </column>
            <column name="project" type="varchar(50)">
                <constraints nullable="false" unique="false"/>
            </column>
            <column name="role" type="varchar(50)">
                <constraints nullable="false" unique="false"/>
            </column>
            <column name="summary" type="varchar(500)">
                <constraints nullable="false" unique="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseTableName="projects" baseColumnNames="userid"
                                 constraintName="fk_project"
                                 onDelete="CASCADE"
                                 onUpdate="NO ACTION"
                                 referencedTableName="users"
                                 referencedColumnNames="id"/>

        <insert tableName="users">
            <column name="username" value="admin"/>
            <column name="firstname" value="Admin"/>
            <column name="lastname" value="Admin"/>
            <column name="title" value="Admin"/>
            <column name="summary" value="Admin's summary"/>
            <column name="salt" value="dM87uFPEsdFQ"/>
            <!-- default password is "password" -->
            <column name="password" value="1c9d2f43c1e2a0b2b8e31174b7c0494fef3655b56a9f5cd33d5294b6eded283d"/>
            <column name="admin" value="true"/>
            <column name="disabled" value="false"/>
        </insert>
        <insert tableName="users">
            <column name="username" value="guest"/>
            <column name="firstname" value="Guest"/>
            <column name="lastname" value="Guest"/>
            <column name="title" value="Guest"/>
            <column name="summary" value="Guest's summary"/>
            <column name="salt" value="dM87uFPEsdFQ"/>
            <!-- default password is "password" -->
            <column name="password" value="1c9d2f43c1e2a0b2b8e31174b7c0494fef3655b56a9f5cd33d5294b6eded283d"/>
            <column name="admin" value="false"/>
            <column name="disabled" value="false"/>
        </insert>
        <insert tableName="skills">
            <column name="userid" value="2"/>
            <column name="skill" value="Java"/>
            <column name="level" value="3"/>
        </insert>
        <insert tableName="qualifications">
            <column name="userid" value="2"/>
            <column name="qualification" value="M.Sc Computer Science, University of Southampton"/>
        </insert>
        <insert tableName="projects">
            <column name="userid" value="2"/>
            <column name="employer" value="Employer"/>
            <column name="project" value="Project"/>
            <column name="role" value="Role"/>
            <column name="summary" value="Project Summary"/>
        </insert>

        <!-- Skills and Competencies-->




        <!--<createTable tableName="skills">-->
            <!--<column name="id" type="bigint" autoIncrement="true">-->
                <!--<constraints primaryKey="true" nullable="false"/>-->
            <!--</column>-->
            <!--<column name="lang" type="varchar(3)">-->
                <!--<constraints nullable="false" unique="false"/>-->
            <!--</column>-->
            <!--<column name="version" type="int">-->
                <!--<constraints nullable="false" unique="false"/>-->
            <!--</column>-->
            <!--<column name="category" type="varchar(50)">-->
                <!--<constraints nullable="false" unique="false"/>-->
            <!--</column>-->
            <!--<column name="subcategory" type="varchar(50)">-->
                <!--<constraints nullable="false" unique="false"/>-->
            <!--</column>-->
            <!--<column name="skill" type="varchar(50)">-->
                <!--<constraints nullable="false" unique="false"/>-->
            <!--</column>-->
            <!--<column name="description" type="varchar(1000)">-->
                <!--<constraints nullable="false" unique="false"/>-->
            <!--</column>-->
            <!--<column name="code" type="varchar(4)">-->
                <!--<constraints nullable="false" unique="false"/>-->
            <!--</column>-->
            <!--<column name="level" type="int">-->
                <!--<constraints nullable="false" unique="false"/>-->
            <!--</column>-->
            <!--<column name="description22" type="varchar(1000)">-->
                <!--<constraints nullable="false" unique="false"/>-->
            <!--</column>-->

        <!--</createTable>-->
<!--&lt;!&ndash;        <addForeignKeyConstraint baseTableName="sfiaskills" baseColumnNames="id"-->
                                 <!--constraintName="fk_project"-->
                                 <!--onDelete="CASCADE"-->
                                 <!--onUpdate="NO ACTION"-->
                                 <!--referencedTableName="users"-->
                                 <!--referencedColumnNames="id"-->
        <!--/>&ndash;&gt;-->

        <!--<insert tableName="skills">-->
            <!--<column name="id" value= "1"/>-->
            <!--<column name="lang" value="test"/>-->
            <!--<column name="version" value="test"/>-->
            <!--<column name="category" value="test"/>-->
            <!--<column name="subcategory" value="test"/>-->
            <!--<column name="skill" value="test"/>-->
            <!--<column name="description" value="test"/>-->
            <!--<column name="code" value="test"/>-->
            <!--<column name="level" value="2"/>-->
            <!--<column name="description22" value="test"/>-->
           <!--</insert>-->

       <!-- <insert tableName="users">
            <column name="username" value="admin"/>
            <column name="firstname" value="Admin"/>
            <column name="lastname" value="Admin"/>
            <column name="title" value="Admin"/>
            <column name="summary" value="Admin's summary"/>
            <column name="salt" value="dM87uFPEsdFQ"/>
            &lt;!&ndash; default password is "password" &ndash;&gt;
            <column name="password" value="1c9d2f43c1e2a0b2b8e31174b7c0494fef3655b56a9f5cd33d5294b6eded283d"/>
            <column name="admin" value="true"/>
            <column name="disabled" value="false"/>
        </insert>-->



    </changeSet>

    <changeSet id="2" author="dw.quickstarts">

        <createTable tableName="sfiaSkills">
            <column name="id" type="bigint" autoIncrement="true">
            <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="lang" type="varchar(3)">
            <constraints nullable="false" unique="false"/>
            </column>
            <column name="version" type="int">
            <constraints nullable="false" unique="false"/>
            </column>
            <column name="category" type="varchar(50)">
            <constraints nullable="false" unique="false"/>
            </column>
            <column name="subcategory" type="varchar(50)">
            <constraints nullable="false" unique="false"/>
            </column>
            <column name="skill" type="varchar(50)">
            <constraints nullable="false" unique="false"/>
            </column>
            <column name="description" type="varchar(2000)">
            <constraints nullable="false" unique="false"/>
            </column>
            <column name="code" type="varchar(4)">
            <constraints nullable="false" unique="false"/>
            </column>
            <column name="level" type="int">
            <constraints nullable="false" unique="false"/>
            </column>
            <column name="description22" type="varchar(2000)">
            <constraints nullable="false" unique="false"/>
            </column>
        </createTable>

        <loadData tableName="sfiaSkills" file="sfiaskills.6.3.en.1.csv">
            <column header="uid" type="skip" />
            <column header="master" type="skip" />
            <column header="title" type="skip" />
            <column header="loc" type="skip" />
            <column header="loc2" type="skip" />
            <column header="uid3" type="skip" />
            <column header="master4" type="skip" />
            <column header="loc16" type="skip" />
            <column header="loc17" type="skip" />
            <column header="uid18" type="skip" />
            <column header="master19" type="skip" />
            <column header="loc21" type="skip" />
            <column header="loc23" type="skip" />

            <column header="loc6" type="skip" />
            <column header="loc7" type="skip" />
            <column header="uid8" type="skip" />
            <column header="master9" type="skip" />
            <column header="loc11" type="skip" />

            <column header="loc12" type="skip" />
            <column header="uid13" type="skip" />
            <column header="master14" type="skip" />


        </loadData>

    </changeSet>

    <changeSet id="3" author="dw.quickstarts">
        <createTable tableName="userSFIASkills">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="sfiaid" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="userid" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="userSFIASkills" baseColumnNames="userid"
                                 constraintName="fk_user_sfiaSkills"
                                 onDelete="CASCADE"
                                 onUpdate="NO ACTION"
                                 referencedTableName="users"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="userSFIASkills" baseColumnNames="sfiaid"
                                 constraintName="fk_sfiaSkills_user"
                                 onDelete="CASCADE"
                                 onUpdate="NO ACTION"
                                 referencedTableName="sfiaSkills"
                                 referencedColumnNames="uid"/>
    </changeSet>



</databaseChangeLog>